<?xml version="1.0" encoding="UTF-8"?>
<html>
 <head>
  <title>Protorabbit Monitor</title>
<script type="text/javascript" src="resources/jmaki/jmaki-full.js"></script>
<script type="text/javascript" src="resources/js/monitor.js"></script>
<script>
jmaki.config =  {
    forceActiveXXHR : true,
    logLevel : 'off'
}

jmaki.subscribe("/jmaki/extensions/widgetFactory/loadComplete", function() {
    toggleRunning();
    updateSummary();
    // update the summary ever 2.5 minutes
    var updater = setInterval( updateSummary, 150000 );
});
</script>

<style>
a  {
  color : #333;
}

.pmenu {
  padding:3px;
  height:40px;
  font-size:2em;
  background:#333;
  color:#fff
}

.pmenu a {
  color : #fff;
  font-size:0.4em;
}

.pmenu a:visited {
  color : #fff;
}

.subTitle {
  text-align : center;
  font-size : 1.1.em;
  font-weight : bold;
}

.blockTable {
  background : #eee;
  border : 1px solid #333;
  width : 100%;
  font-size : .8em;
  overflow : hidden;
}

.blockTable td {
  background : #fff;
}

.legend {
  font-size : .9em;
}
</style>

<script>

</script>
 </head>
 <body>
  <div class="pmenu">
   <div style="float:left">Protorabbit Resources</div>
    <div style="float:right">
    <a href="episodes.html">Episodes</a>
    <a href="components.html">Components</a>
    <a href="resources.html">Resources</a>
    <a href="statistics.html">  Statistics</a>
    <a href="../"> Home</a>
   </div>
  </div>
  <div id="body" style="padding:15px">
  
     <!--  Start week summary -->
     <fieldset>
     <legend class="subTitle">
       <span>
        Summary :
        <select id="summaryResolution" onchange="updateSummary()">
         <option value="ONE_DAY" selected="selected">Last Day</option>
         <option value="ONE_WEEK">Last Week</option>
        </select>
        </span>
     </legend>
       <div style="height:120px">
         <div jmakiName="jmaki.charting.line" jmakiId="weekSummary" style="overflow:hidden;height:100%"
              jmakiArgs="{
                    colors : [ '#4da74d', '#EB5E66',  '#D41A1F', '#AF1E2D', '#9E0508','#E31230' ],
                    showHoverLabels : true,
                    leftMargin : 35,
                    hoverFormatter : function(m){
                        if (m.value.x) {
                            return formatTimestamp(m.value.x) + ' ' + m.value.y;
                        } else {
                            return m.value;
                        }
                    },
                    xAxis : {
                       mode : 'time',
                       timeUnit : 'hour',
                    },
                    yAxis : {
                     title : 'Requests' ,
                     rotate : true,
                     tickFormatter : function(val) {
                         return val.toFixed(1);
                       }
                    },
                    y2Axis : {
                      rotate : true,
                      min : 0,
                    }

                   }"
               ></div>
    </div>
    </fieldset>
  <!--  end week summary -->
    <div style="height:10px"></div>
    <!--  start current --> 
    <fieldset>
    <legend class="subTitle">Current
        <span>
     :
     <select id="timespan" onchange="loadPageViews(true)">
       <option value="60">Last Minute</option>
       <option value="300">Last 5 Minutes</option>
       <option value="600">Last 10 Minutes</option>
       <option value="1200">Last 20 Minutes</option>
       <option value="1800">Last 40 Minutes</option>
       <option value="3600">Last Hour</option>
     </select>
    </span>
    </legend>
    <div style="height:10px"></div>
      <!-- start controls -->
    <div style="text-align:center">

    <span>

    Resolution :
     <select id="resolution" onchange="updateResolution()">
       <option value="SECOND">Second</option>
       <option value="MINUTE">Minute</option>
       <option value="HOUR">Hour</option>
     </select>
    </span>
    <span>&nbsp;&nbsp;
    Status :</span>
    <span id="runControlStatus">
    </span>
    <span>
       &nbsp;&nbsp;
       <a id="runControl" href="javascript:void(0)" onclick="toggleRunning()">Initializing...</a>
    </span>
    <span>&nbsp;&nbsp;</span>
    <span id="status"></span></div>
   <!-- end controls -->


  <div style="float:left;width:300px"> 
  <div style="padding-top:10px;text-align:center;font-size:1.2em">Pages (text/html)</div>

  <div jmakiId="views" jmakiName="jmaki.charting.pie"
       jmakiArgs="{ legend : { targetId : 'dispoLegend',
                    labelFormatter : function(contents,value, x,y) {
                    return contents + '&nbsp;' + value.percent.toFixed(1) + '%&nbsp;(' +  (value.data) + ')';
                  }
                  }, showHoverLabels : false }"
       style="height:275px"></div>
   <div id="dispoLegend" class="legend" style="clear:left;float:left"></div>

   <div style="clear:both;height:5px"></div>
   
   <div id="totalResources" style="text-align:center;clear:both"></div>

   <div style="clear:both;height:15px"></div>

   <div style="text-align:center;font-size:1.2em">Hops (application/json)</div>
  <div jmakiId="actions" jmakiName="jmaki.charting.pie"
       jmakiArgs="{ legend : { targetId : 'topResourcesLegend',
                    labelFormatter : function(contents,value, x,y) {
                    return contents + '&nbsp;' + value.percent.toFixed(1) + '%&nbsp;(' +  (value.data) + ')';
                  }
                  }, showHoverLabels : false }"
       style="height:275px"></div>   
   <div id="topResourcesLegend" class="legend" style="clear:left;float:left"></div>
      <div style="clear:both;height:5px"></div>
     <div style="padding-top:10px;text-align:center;font-size:1.2em">Pollers (application/json)</div>
   
     <div jmakiId="pollers" jmakiName="jmaki.charting.pie"
       jmakiArgs="{ legend : { targetId : 'pollerLegend',
                    labelFormatter : function(contents,value, x,y) {
                    return contents + '&nbsp;' + value.percent.toFixed(1) + '%&nbsp;(' +  (value.data) + ')';
                  }
                  }, showHoverLabels : false }"
       style="height:275px"></div>
   <div id="pollerLegend" class="legend" style="clear:left;float:left"></div>

  </div>

  <div style="margin-top:5px;margin-left:305px">

    <div style="height:200px">
         <div jmakiName="jmaki.charting.line" jmakiId="realtimeStats" style="overflow:hidden;height:100%"
              jmakiArgs="{
                    colors : [ '#4da74d', '#EB5E66',  '#D41A1F', '#AF1E2D', '#9E0508','#E31230' ],
                    showHoverLabels : true,
                    leftMargin : 35,
                    hoverFormatter : function(m){
                        if (m.value.x) {
                            return formatTimestamp(m.value.x) + ' ' + m.value.y;
                        } else {
                            return m.value;
                        }
                    },
                    xAxis : {
                       mode : 'time',
                       timeUnit : 'hour',
                    },
                    yAxis : {
                     title : 'Requests' ,
                     rotate : true,
                     tickFormatter : function(val) {
                         return val.toFixed(1);
                       }
                    },
                    y2Axis : {
                      rotate : true,
                      min : 0,
                    }

                   }"
               ></div>
          </div> 

       <div style="height:5px"></div>
  
      <div style="height:150px">
         <div jmakiName="jmaki.charting.line" jmakiId="responseTimeChart" style="overflow:hidden;height:100%"
              jmakiArgs="{
                    colors : [ '#4da74d', '#EB5E66',  '#D41A1F', '#AF1E2D', '#9E0508','#E31230' ],
                    showHoverLabels : true,
                    leftMargin : 35,
                    hoverFormatter : function(m){
                        if (m.value.x) {
                            return formatTimestamp(m.value.x) + ' ' + m.value.y.toFixed(1) + 'ms';
                        } else {
                            return m.value;
                        }
                    },
                    xAxis : {
                       mode : 'time',
                       timeUnit : 'hour'
                    },
                    yAxis : {
                     title : 'Processing Time (ms)' ,
                     rotate : true,
                     tickFormatter : function(val) {
                         return val.toFixed(1);
                       }
                    },
                    y2Axis : {
                      rotate : true,
                      min : 0,
                    }
                   }"
               ></div>
          </div> 
    </div>
  
  <div style="height:5px"></div>
  <!-- start mid poller / error panel -->
  <div style="margin-top:15px;margin-left:305px;height:300px;">
    <div style="float:left;width:50%;height:300px">
        <div id="clientsTitle" class="subTitle">Clients</div>
        <div id="clientsPanel" style="height:285px; overflow-y:auto;border: 1px solid #eee;padding:5px;margin:1px;"></div>
    </div>
    <div style="float:left;width:50%;height:300px;">
      <div id="errorsTitle" class="subTitle">Errors</div>
      <div id="errorsPanel" style="height:285px; overflow-y:auto;border: 1px solid #eee;padding:5px;margin:1px;"></div>
   </div>
  </div><!-- end mid poller / error panel -->
</fieldset><!--  end current -->
 </div>
 </body>
</html>